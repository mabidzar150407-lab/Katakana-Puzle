<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Puzzle Katakana — Leveling Game</title>

<style>
    body {
        font-family: 'Arial';
        background: #f0f3f7;
        padding: 25px;
        user-select: none;
    }

    h1 {
        text-align: center;
        margin-bottom: 5px;
    }

    .info-area {
        height: 45px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        margin: 15px 0;
        color: #555;
    }

    /* ROW */
    .row {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 25px;
        flex-wrap: wrap;
    }

    /* SLOT */
    .slot {
        width: 80px;
        height: 80px;
        background: white;
        border: 2px dashed #b8b8b8;
        border-radius: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: 0.2s;
    }

    .slot:hover {
        border-color: #7aa7ff;
    }

    /* CARD 3D FLIP */
    .card {
        width: 76px;
        height: 76px;
        cursor: grab;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
    }

    .card-inner {
        position: absolute;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.6s;
    }

    .card.flipped .card-inner {
        transform: rotateY(180deg);
    }

    .front, .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 34px;
        font-weight: bold;
    }

    .front {
        background: #4d7cff;
        color: white;
    }

    .back {
        transform: rotateY(180deg);
        background: #ffdd9c;
        font-size: 26px;
        color: black;
    }

    /* RESULT */
    #result {
        text-align: center;
        font-size: 26px;
        margin-top: 5px;
        height: 40px;
        font-weight: bold;
    }

        /* BOTTOM BAR */
    .bottom-bar {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 25px;
        align-items: center;
    }

    #levelText {
        font-size: 22px;
        font-weight: bold;
        color: #333;
    }

    #nextBtn {
        padding: 12px 20px;
        font-size: 18px;
        background: #2196F3;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: none;
        transition: 0.2s;
    }

    #nextBtn:hover {
        background: #0b7dda;
    }

    #backBtn {
        padding: 12px 20px;
        font-size: 18px;
        background: #888;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
  	transition: 0.2s;
    }

    #backBtn:hover {
        background: #555;
    }

</style>
</head>
<body>

<h1>Puzzle Katakana</h1>

<div class="row" id="topRow"></div>

<div class="info-area">Susun huruf katakana di bawah</div>

<div class="row" id="bottomRow"></div>

<div id="result"></div>

<div class="bottom-bar">
    <button id="backBtn">⬅ KEMBALI</button>
    <div id="levelText">Level 1</div>
    <button id="nextBtn">NEXT ➜</button>
</div>

<script>
/* ========================== WORD LIST ========================== */
const wordList = [
    "テレビ",
    "コンピューター",
    "バス",
    "パン",
    "コーヒー",
    "アイスクリーム",
    "タクシー",
    "ホテル",
    "レストラン",
    "スマホ",
    "ビデオ"
];

let usedLevels = [];
let currentWord = "";
let correctOrder = [];
let draggedCard = null;

/* ROMAJI MAP */
const romajiMap = {
    "ア":"a","イ":"i","ウ":"u","エ":"e","オ":"o",
    "テ":"te","レ":"re","ビ":"bi","コ":"ko","ン":"n",
    "ピ":"pi","ュ":"yu","タ":"ta","ク":"ku","シ":"shi",
    "ム":"mu","ホ":"ho","ト":"to","ル":"ru","ス":"su",
    "マ":"ma","ハ":"ha"
};

/* ================ LEVEL GENERATOR ================= */
function chooseNewWord() {
    if (usedLevels.length === wordList.length) usedLevels = [];

    let options = wordList.filter(w => !usedLevels.includes(w));
    currentWord = options[Math.floor(Math.random() * options.length)];
    usedLevels.push(currentWord);

    correctOrder = [...currentWord];
}

/* ================ SHUFFLE ================= */
function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

/* ================ CREATE CARD ================= */
function createCard(kana){
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.value = kana;
    card.draggable = true;

    card.innerHTML = `
        <div class="card-inner">
            <div class="front">${kana}</div>
            <div class="back">${romajiMap[kana] ?? ""}</div>
        </div>
    `;

    card.addEventListener("dragstart", () => draggedCard = card);
    card.addEventListener("dragend", () => draggedCard = null);

    card.addEventListener("click", () => {
        card.classList.toggle("flipped");
    });

    return card;
}

/* ================ BUILD LEVEL ================= */
function generateLevel(){
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("result").innerText = "";

    chooseNewWord();

    document.getElementById("levelText").innerText =
        "Level " + usedLevels.length;

    const topRow = document.getElementById("topRow");
    const bottomRow = document.getElementById("bottomRow");

    topRow.innerHTML = "";
    bottomRow.innerHTML = "";

    /* bottom = jumlah huruf jawaban */
    correctOrder.forEach(() => {
        const s = document.createElement("div");
        s.className = "slot";
        bottomRow.appendChild(s);
    });

    /* atas = lebih banyak dari jawaban (jawaban + noise) */
    let amountTop = correctOrder.length + Math.floor(Math.random() * 3) + 2;

    let noisePool = Object.keys(romajiMap)
        .filter(k => !correctOrder.includes(k));

    shuffle(noisePool);

    let topLetters = [...correctOrder, ...noisePool.slice(0, amountTop - correctOrder.length)];

    shuffle(topLetters);

    topLetters.forEach(kana => {
        const slot = document.createElement("div");
        slot.className = "slot";
        slot.appendChild(createCard(kana));
        topRow.appendChild(slot);
    });

    enableSlotEvents();
}

/* ================ SLOT DRAG LOGIC (SWAP ENABLED) ================= */
function enableSlotEvents(){
    document.querySelectorAll(".slot").forEach(slot => {

        slot.addEventListener("dragover", e => e.preventDefault());

        slot.addEventListener("drop", () => {
            if (!draggedCard) return;

            const origin = draggedCard.parentElement;
            const target = slot.firstElementChild;

            if (target) origin.appendChild(target);

            slot.appendChild(draggedCard);

            checkAnswer();
        });
    });
}

/* ================ CHECK ANSWER ================= */
function checkAnswer(){
    const bottomSlots = document.querySelectorAll("#bottomRow .slot");

    let current = [];
    bottomSlots.forEach(slot => {
        if (slot.firstElementChild) current.push(slot.firstElementChild.dataset.value);
        else current.push(null);
    });

    if (current.includes(null)) {
        document.getElementById("result").innerText = "";
        return;
    }

    if (JSON.stringify(current) === JSON.stringify(correctOrder)) {
        document.getElementById("result").innerText = "BENAR! ✔️";
        document.getElementById("nextBtn").style.display = "block";
    } else {
        document.getElementById("result").innerText = "Salah ❌";
    }
}

/* NEXT */

document.getElementById("nextBtn").onclick = generateLevel;

document.getElementById("backBtn").onclick = () => {
    history.back();
};



/* INIT */
generateLevel();
</script>
</body>
</html>
